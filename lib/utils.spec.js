'use strict';

var chai = require('chai');
chai.use(require('sinon-chai'));
var expect = chai.expect;
var sinon = require('sinon');
var _ = require('lodash');
var stream = require('stream');
var EventEmitter = require('events').EventEmitter;
var utils = require('./utils');

describe('sequence', function () {
  describe('create', function () {
    it('applies backpressure and remembers everything', function () {
      var s = utils.sequence({ highWaterMark: 2 });
      expect(s.write([1, 2, 3, 4])).to.be.true;
      expect(s.read()).to.equal(1);
      expect(s.write([5])).to.be.false;
      expect(s.read()).to.equal(2);
      expect(s.read()).to.equal(3);
      expect(s.read()).to.equal(4);
      expect(s.read()).to.equal(5);
      expect(s.write([6, 7])).to.be.true;
      expect(s.read()).to.equal(6);
      expect(s.read()).to.equal(7);
      expect(s.read()).to.equal(null);
    });
  });

  describe('filter', function () {
    it('filters by predicate', function (done) {
      var s1 = new stream.Readable({ objectMode: true });
      s1._read = function () {
        return null;
      };

      var filtered = s1.pipe(utils.filter(_.isNumber));
      s1.push('foo');
      s1.push('bar');
      s1.push(1);
      filtered.on('readable', function () {
        expect(filtered.read()).to.equal(1);
        done();
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy5zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxPQUFPLFFBQVEsTUFBUixDQUFQO0FBQ0osS0FBSyxHQUFMLENBQVMsUUFBUSxZQUFSLENBQVQ7QUFDQSxJQUFJLFNBQVMsS0FBSyxNQUFMO0FBQ2IsSUFBSSxRQUFRLFFBQVEsT0FBUixDQUFSO0FBQ0osSUFBSSxJQUFJLFFBQVEsUUFBUixDQUFKO0FBQ0osSUFBSSxTQUFTLFFBQVEsUUFBUixDQUFUO0FBQ0osSUFBSSxlQUFlLFFBQVEsUUFBUixFQUFrQixZQUFsQjtBQUNuQixJQUFJLFFBQVEsUUFBUSxTQUFSLENBQVI7O0FBRUosU0FBUyxVQUFULEVBQXFCLFlBQU07QUFDekIsV0FBUyxRQUFULEVBQW1CLFlBQU07QUFDdkIsT0FBRywrQ0FBSCxFQUFvRCxZQUFNO0FBQ3hELFVBQUksSUFBSSxNQUFNLFFBQU4sQ0FBZSxFQUFFLGVBQWUsQ0FBZixFQUFqQixDQUFKLENBRG9EO0FBRXhELGFBQU8sRUFBRSxLQUFGLENBQVEsQ0FBQyxDQUFELEVBQUcsQ0FBSCxFQUFLLENBQUwsRUFBTyxDQUFQLENBQVIsQ0FBUCxFQUEyQixFQUEzQixDQUE4QixFQUE5QixDQUFpQyxJQUFqQyxDQUZ3RDtBQUd4RCxhQUFPLEVBQUUsSUFBRixFQUFQLEVBQWlCLEVBQWpCLENBQW9CLEtBQXBCLENBQTBCLENBQTFCLEVBSHdEO0FBSXhELGFBQU8sRUFBRSxLQUFGLENBQVEsQ0FBQyxDQUFELENBQVIsQ0FBUCxFQUFxQixFQUFyQixDQUF3QixFQUF4QixDQUEyQixLQUEzQixDQUp3RDtBQUt4RCxhQUFPLEVBQUUsSUFBRixFQUFQLEVBQWlCLEVBQWpCLENBQW9CLEtBQXBCLENBQTBCLENBQTFCLEVBTHdEO0FBTXhELGFBQU8sRUFBRSxJQUFGLEVBQVAsRUFBaUIsRUFBakIsQ0FBb0IsS0FBcEIsQ0FBMEIsQ0FBMUIsRUFOd0Q7QUFPeEQsYUFBTyxFQUFFLElBQUYsRUFBUCxFQUFpQixFQUFqQixDQUFvQixLQUFwQixDQUEwQixDQUExQixFQVB3RDtBQVF4RCxhQUFPLEVBQUUsSUFBRixFQUFQLEVBQWlCLEVBQWpCLENBQW9CLEtBQXBCLENBQTBCLENBQTFCLEVBUndEO0FBU3hELGFBQU8sRUFBRSxLQUFGLENBQVEsQ0FBQyxDQUFELEVBQUcsQ0FBSCxDQUFSLENBQVAsRUFBdUIsRUFBdkIsQ0FBMEIsRUFBMUIsQ0FBNkIsSUFBN0IsQ0FUd0Q7QUFVeEQsYUFBTyxFQUFFLElBQUYsRUFBUCxFQUFpQixFQUFqQixDQUFvQixLQUFwQixDQUEwQixDQUExQixFQVZ3RDtBQVd4RCxhQUFPLEVBQUUsSUFBRixFQUFQLEVBQWlCLEVBQWpCLENBQW9CLEtBQXBCLENBQTBCLENBQTFCLEVBWHdEO0FBWXhELGFBQU8sRUFBRSxJQUFGLEVBQVAsRUFBaUIsRUFBakIsQ0FBb0IsS0FBcEIsQ0FBMEIsSUFBMUIsRUFad0Q7S0FBTixDQUFwRCxDQUR1QjtHQUFOLENBQW5CLENBRHlCOztBQWtCekIsV0FBUyxRQUFULEVBQW1CLFlBQU07QUFDdkIsT0FBRyxzQkFBSCxFQUEyQixnQkFBUTtBQUNqQyxVQUFJLEtBQUssSUFBSSxPQUFPLFFBQVAsQ0FBZ0IsRUFBQyxZQUFZLElBQVosRUFBckIsQ0FBTCxDQUQ2QjtBQUVqQyxTQUFHLEtBQUgsR0FBVztlQUFNO09BQU4sQ0FGc0I7O0FBSWpDLFVBQUksV0FBVyxHQUFHLElBQUgsQ0FBUSxNQUFNLE1BQU4sQ0FBYSxFQUFFLFFBQUYsQ0FBckIsQ0FBWCxDQUo2QjtBQUtqQyxTQUFHLElBQUgsQ0FBUSxLQUFSLEVBTGlDO0FBTWpDLFNBQUcsSUFBSCxDQUFRLEtBQVIsRUFOaUM7QUFPakMsU0FBRyxJQUFILENBQVEsQ0FBUixFQVBpQztBQVFqQyxlQUFTLEVBQVQsQ0FBWSxVQUFaLEVBQXdCLFlBQU07QUFDNUIsZUFBTyxTQUFTLElBQVQsRUFBUCxFQUF3QixFQUF4QixDQUEyQixLQUEzQixDQUFpQyxDQUFqQyxFQUQ0QjtBQUU1QixlQUY0QjtPQUFOLENBQXhCLENBUmlDO0tBQVIsQ0FBM0IsQ0FEdUI7R0FBTixDQUFuQixDQWxCeUI7Q0FBTixDQUFyQiIsImZpbGUiOiJ1dGlscy5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNoYWkgPSByZXF1aXJlKCdjaGFpJyk7XG5jaGFpLnVzZShyZXF1aXJlKCdzaW5vbi1jaGFpJykpO1xudmFyIGV4cGVjdCA9IGNoYWkuZXhwZWN0O1xudmFyIHNpbm9uID0gcmVxdWlyZSgnc2lub24nKTtcbnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG52YXIgc3RyZWFtID0gcmVxdWlyZSgnc3RyZWFtJyk7XG52YXIgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnZXZlbnRzJykuRXZlbnRFbWl0dGVyO1xudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpXG5cbmRlc2NyaWJlKCdzZXF1ZW5jZScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ2NyZWF0ZScsICgpID0+IHtcbiAgICBpdCgnYXBwbGllcyBiYWNrcHJlc3N1cmUgYW5kIHJlbWVtYmVycyBldmVyeXRoaW5nJywgKCkgPT4ge1xuICAgICAgdmFyIHMgPSB1dGlscy5zZXF1ZW5jZSh7IGhpZ2hXYXRlck1hcms6IDJ9KTtcbiAgICAgIGV4cGVjdChzLndyaXRlKFsxLDIsMyw0XSkpLnRvLmJlLnRydWVcbiAgICAgIGV4cGVjdChzLnJlYWQoKSkudG8uZXF1YWwoMSk7XG4gICAgICBleHBlY3Qocy53cml0ZShbNV0pKS50by5iZS5mYWxzZVxuICAgICAgZXhwZWN0KHMucmVhZCgpKS50by5lcXVhbCgyKTtcbiAgICAgIGV4cGVjdChzLnJlYWQoKSkudG8uZXF1YWwoMyk7XG4gICAgICBleHBlY3Qocy5yZWFkKCkpLnRvLmVxdWFsKDQpO1xuICAgICAgZXhwZWN0KHMucmVhZCgpKS50by5lcXVhbCg1KTtcbiAgICAgIGV4cGVjdChzLndyaXRlKFs2LDddKSkudG8uYmUudHJ1ZVxuICAgICAgZXhwZWN0KHMucmVhZCgpKS50by5lcXVhbCg2KTtcbiAgICAgIGV4cGVjdChzLnJlYWQoKSkudG8uZXF1YWwoNyk7XG4gICAgICBleHBlY3Qocy5yZWFkKCkpLnRvLmVxdWFsKG51bGwpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmlsdGVyJywgKCkgPT4ge1xuICAgIGl0KCdmaWx0ZXJzIGJ5IHByZWRpY2F0ZScsIGRvbmUgPT4ge1xuICAgICAgdmFyIHMxID0gbmV3IHN0cmVhbS5SZWFkYWJsZSh7b2JqZWN0TW9kZTogdHJ1ZX0pO1xuICAgICAgczEuX3JlYWQgPSAoKSA9PiBudWxsO1xuXG4gICAgICB2YXIgZmlsdGVyZWQgPSBzMS5waXBlKHV0aWxzLmZpbHRlcihfLmlzTnVtYmVyKSk7XG4gICAgICBzMS5wdXNoKCdmb28nKTtcbiAgICAgIHMxLnB1c2goJ2JhcicpO1xuICAgICAgczEucHVzaCgxKTtcbiAgICAgIGZpbHRlcmVkLm9uKCdyZWFkYWJsZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGZpbHRlcmVkLnJlYWQoKSkudG8uZXF1YWwoMSlcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=